@using HRMS.Models.Common;
<link href="~/assets/pages/gridlist.css" rel="stylesheet" />

@model Results
@{
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Whats Happening";

    var success = TempData["Success"];
    var Err = TempData["Error"];
}
<div class="main-header anim" style="--delay: 0s">
    Whats Happening  
</div>
<div class="card p-3">
<div class="row g-3" id="whatsHappeningGridContainer"></div>
<div class="modal fade" id="announcementModal" tabindex="-1" aria-labelledby="announcementModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">

        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="announcementModalLabel">Announcement Details</h5>
                <button type="button" class="btn-close" id="Closepopopup" data-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <img id="modalImage" src="" class="rounded mb-3"   alt="Announcement Image">
                <h5 id="modalTitle"></h5>
                <p id="modalDescription"></p>
                <p><b>From Date:</b> <span id="modalFromDate"></span></p>
                <p><b>To Date:</b> <span id="modalToDate"></span></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondaryannouncement" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
</div>
<script type="text/javascript">
       $(document).ready(function () {
        $.ajax({
            url: "Whatshappening/",
            type: "POST",
            dataType: "json",
            success: function (json) {
                if (json && json.data) {
                    renderGrid(json.data);
                }
            }
        });

        function renderGrid(data) {
            var container = $("#whatsHappeningGridContainer");
            container.empty();

            data.forEach(item => {
                const card = `
                    <div class="col-md-4 mb-4">
                        <div class="card h-100 shadow-sm">
                            <img src="${item.iconImage || '~/assets/images/no-image.png'}" class="card-img-top" alt="${item.title}" style="height: 200px; object-fit: cover;">
                            <div class="card-body">
                                <h5 class="card-title">${item.title}</h5>
                                <p class="card-text"><b>Date:</b> ${formatDate(item.fromDate)}</p>
                                <button class="btn btn-outline-primary view-announcement-btn"
                                    data-id="${item.whatsHappeningID}"
                                    data-title="${item.title}"
                                    data-description="${item.description.replace(/<\/?p>/g, '')}"
                                    data-fromdate="${formatDate(item.fromDate)}"
                                    data-todate="${formatDate(item.toDate)}"
                                    data-image="${item.iconImage}">
                                    View Announcement
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                container.append(card);
            });
        }

        $(document).on('click', '.view-announcement-btn', function () {
            $('#modalTitle').text($(this).data('title'));
            $('#modalDescription').html($(this).data('description'));
            $('#modalFromDate').text($(this).data('fromdate'));
            $('#modalToDate').text($(this).data('todate'));
            $('#modalImage').attr('src', $(this).data('image'));
            $('#announcementModal').modal('show');
        });

        $(document).on('click', '#Closepopopup', function () {
            $('#announcementModal').modal('hide');
        });

        function formatDate(dateStr) {
            if (!dateStr) return "";
            let date = new Date(dateStr);
            let day = date.getDate();
            let monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            let month = monthNames[date.getMonth()];
            let year = date.getFullYear();
            return `${day} ${month} ${year}`;
        }
    });
</script>