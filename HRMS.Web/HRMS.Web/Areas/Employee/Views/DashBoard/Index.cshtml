@using HRMS.Models.Common
@using Microsoft.AspNetCore.Http
@model HRMS.Models.DashBoard.DashBoardModel;
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor
@inject HRMS.Web.BusinessLayer.IBusinessLayer _businessLayer
@{
    Layout = String.Format("~/Areas/{0}/Views/Shared/_Layout.cshtml", @HttpContextAccessor.HttpContext.Session.GetString(HRMS.Models.Common.Constants.AreaName));
    var RoleName = Convert.ToInt64(this.Context.Session.GetString(Constants.RoleID));

    ViewData["Title"] = "Dashboard";
}

<div class="main-header anim" style="--delay: 0s">Dashboard</div>
<div class="page-wrapper dashboard-page">
    <div class="page-name 	mb-4">
        <h4 class="m-0"><img src="@_businessLayer.GetProfilePhoto()" onerror="this.onerror=null; this.src='@(HRMS.Models.Common.Constants.NoImagePath)'" class="mr-1" alt="profile" /> Hi @Model.FirstName (@Model.EmployeNumber), @_businessLayer.GetSatutation() !</h4>
        <label>@DateTime.Now.ToString("ddd, dd MMM yyy")</label>
    </div>

    <div class="row mb-4">
        @if (RoleName == Convert.ToInt64(Roles.Admin) || RoleName == Convert.ToInt64(Roles.Manager))
        {
            <div class="col-xl-3 col-sm-6 col-12">
                <div class="card board1 fill1 " id="RedirectBtn">

                    <div class="card-body">
                        <div class="card_widget_header">
                            <label>Employees</label>
                            <h4>@Model.NoOfEmployees</h4>
                        </div>
                        <div class="card_widget_img">
                            <svg width="20px" height="20px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M1.5 6.5C1.5 3.46243 3.96243 1 7 1C10.0376 1 12.5 3.46243 12.5 6.5C12.5 9.53757 10.0376 12 7 12C3.96243 12 1.5 9.53757 1.5 6.5Z" fill="#000000" />
                                <path d="M14.4999 6.5C14.4999 8.00034 14.0593 9.39779 13.3005 10.57C14.2774 11.4585 15.5754 12 16.9999 12C20.0375 12 22.4999 9.53757 22.4999 6.5C22.4999 3.46243 20.0375 1 16.9999 1C15.5754 1 14.2774 1.54153 13.3005 2.42996C14.0593 3.60221 14.4999 4.99966 14.4999 6.5Z" fill="#000000" />
                                <path d="M0 18C0 15.7909 1.79086 14 4 14H10C12.2091 14 14 15.7909 14 18V22C14 22.5523 13.5523 23 13 23H1C0.447716 23 0 22.5523 0 22V18Z" fill="#000000" />
                                <path d="M16 18V23H23C23.5522 23 24 22.5523 24 22V18C24 15.7909 22.2091 14 20 14H14.4722C15.4222 15.0615 16 16.4633 16 18Z" fill="#000000" />
                            </svg>
                        </div>
                    </div>

                </div>
            </div>
        }
        @*  <div class="col-xl-3 col-sm-6 col-12">
        <div class="card board1 fill2 ">
        <div class="card-body">
        <div class="card_widget_header">
        <label>Companies</label>
        <h4>@Model.NoOfCompanies</h4>
        </div>
        <div class="card_widget_img">
        <svg fill="#000000" width="20px" height="20px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M21,8H16V3a1,1,0,0,0-1-1H9A1,1,0,0,0,8,3V8H3A1,1,0,0,0,2,9V22h9V19a1,1,0,0,1,2,0v3h9V9A1,1,0,0,0,21,8ZM6,20H4V18H6Zm0-4H4V14H6Zm0-4H4V10H6Zm7,3H11V13h2Zm0-4H11V9h2Zm0-4H11V5h2Zm7,13H18V18h2Zm0-4H18V14h2Zm0-4H18V10h2Z" /></svg>
        </div>
        </div>
        </div>
        </div> *@
        <div class="col-xl-3 col-sm-6 col-12">
            <div class="card board1 fill3 ">
                <div class="card-body">
                    <div class="card_widget_header">
                        <label>Leaves</label>
                        <h4>@Convert.ToInt32(@Model.TotalLeave)</h4>
                    </div>
                    <div class="card_widget_img">
                        <svg width="20px" height="20px" viewBox="0 0 512 512" id="Layer_1" version="1.1" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g>
<path class="st0" d="M442.5,30h-69.7c-2.9,0-5.4,1.7-6.5,4.4L261.8,295.9c-1.4,3.6,0.3,7.7,3.9,9.1c0.9,0.3,1.7,0.5,2.6,0.5   c2.8,0,5.4-1.7,6.5-4.4L377.6,44h64.9c3.9,0,7-3.1,7-7S446.4,30,442.5,30z" />
<path class="st0" d="M149.7,204.9c11-2.7,24.1-2.2,37.5,1.8c8.1,2.4,15.8,5.7,23.3,8.9c7.5,3.2,14.5,6.2,22,8.4   c16.4,4.8,31.6,3.6,40.7-3.3c2-1.5,3.9-3.5,5.9-5.5l37.6-94.1H149.7V204.9z" />
<path class="st0" d="M326,210.8c2.2,2.5,4.1,5.2,5.5,7.8c1.4,2.6,2.5,5.2,3.4,7.4c1.9,4.5,3.2,7.7,6.8,10.8   c5.8,5.1,13.6,8.1,21.2,8.3c11,0.2,18.8-4.4,24.1-10.2V121.2h-25.2L326,210.8z" />
<path class="st0" d="M362.6,259.1c-10.9-0.2-21.8-4.5-30.1-11.7c-6-5.3-8.4-10.9-10.5-16c-0.7-1.8-1.4-3.4-2.3-5.1l-31.9,79.9   c-3.2,8-10.9,13.2-19.5,13.2c-2.7,0-5.3-0.5-7.8-1.5c-10.8-4.3-16-16.5-11.7-27.3l21-52.7c-11.7,4-26.4,3.9-41.4-0.5   c-8.2-2.4-16-5.8-23.5-9c-7.4-3.2-14.4-6.2-21.7-8.3c-12.6-3.8-24.6-3.9-33.5-0.7v45.2c0,59,43.1,108,99.5,117.1   c6.2,1,12.6,1.5,19.2,1.5c6.5,0,12.9-0.5,19.2-1.5c56.4-9.2,99.5-58.1,99.5-117.1v-12c-6.9,4.2-14.9,6.4-23.4,6.4   C363.3,259.1,362.9,259.1,362.6,259.1z M234.9,270.5l-9.6,26.1c-0.9,2.5-3.7,3.8-6.2,2.9l-26.1-9.6c-2.5-0.9-3.8-3.7-2.8-6.2   l9.6-26.1c0.9-2.5,3.7-3.8,6.1-2.8l26.1,9.6C234.6,265.3,235.9,268,234.9,270.5z M348.2,302.4l-21.1,14.3c-2,1.4-4.7,0.8-6.1-1.2   l-14.3-21.1c-1.4-2-0.8-4.7,1.2-6.1l21.1-14.3c2-1.3,4.7-0.8,6.1,1.2l14.3,21.1C350.7,298.3,350.2,301,348.2,302.4z" />
<path class="st0" d="M149.7,34c-48.1,0-87.2,39-87.2,87.2c0,43.4,31.7,79.3,73.2,86v-100h100C229,65.7,193,34,149.7,34z    M103.6,133.4c-13.9,0-15.2-5.4-15.2-12.2c0-6.7,1.3-12.2,15.2-12.2s25.2,5.4,25.2,12.2C128.7,127.9,117.5,133.4,103.6,133.4z    M149.7,100.3c-6.7,0-12.2-11.3-12.2-25.2s5.4-15.2,12.2-15.2c6.7,0,12.2,1.3,12.2,15.2S156.4,100.3,149.7,100.3z" />
<path class="st0" d="M287.5,446.2V396c-6.3,0.9-12.8,1.4-19.2,1.4c-6.4,0-12.8-0.5-19.2-1.4v50.2c-19.8,5.2-36.4,18.4-46.2,35.9   h130.8C323.9,464.5,307.3,451.4,287.5,446.2z" />
</g>
</svg>
                    </div>
                </div>
            </div>
        </div>
        @* <div class="col-xl-3 col-sm-6 col-12">
        <div class="card board1 fill4 ">
        <div class="card-body">
        <div class="card_widget_header">
        <label>Salary</label>
        <h4>@Model.Salary</h4>
        </div>
        <div class="card_widget_img">
        <svg width="20px" height="20px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path fill-rule="evenodd" clip-rule="evenodd" d="M12.052 1.25H11.948C11.0495 1.24997 10.3003 1.24995 9.70552 1.32991C9.07773 1.41432 8.51093 1.59999 8.05546 2.05546C7.59999 2.51093 7.41432 3.07773 7.32991 3.70552C7.27259 4.13189 7.25637 5.15147 7.25179 6.02566C5.22954 6.09171 4.01536 6.32778 3.17157 7.17157C2 8.34315 2 10.2288 2 14C2 17.7712 2 19.6569 3.17157 20.8284C4.34314 22 6.22876 22 9.99998 22H14C17.7712 22 19.6569 22 20.8284 20.8284C22 19.6569 22 17.7712 22 14C22 10.2288 22 8.34315 20.8284 7.17157C19.9846 6.32778 18.7705 6.09171 16.7482 6.02566C16.7436 5.15147 16.7274 4.13189 16.6701 3.70552C16.5857 3.07773 16.4 2.51093 15.9445 2.05546C15.4891 1.59999 14.9223 1.41432 14.2945 1.32991C13.6997 1.24995 12.9505 1.24997 12.052 1.25ZM15.2479 6.00188C15.2434 5.15523 15.229 4.24407 15.1835 3.9054C15.1214 3.44393 15.0142 3.24644 14.8839 3.11612C14.7536 2.9858 14.5561 2.87858 14.0946 2.81654C13.6116 2.7516 12.964 2.75 12 2.75C11.036 2.75 10.3884 2.7516 9.90539 2.81654C9.44393 2.87858 9.24644 2.9858 9.11612 3.11612C8.9858 3.24644 8.87858 3.44393 8.81654 3.9054C8.771 4.24407 8.75661 5.15523 8.75208 6.00188C9.1435 6 9.55885 6 10 6H14C14.4412 6 14.8565 6 15.2479 6.00188ZM12 9.25C12.4142 9.25 12.75 9.58579 12.75 10V10.0102C13.8388 10.2845 14.75 11.143 14.75 12.3333C14.75 12.7475 14.4142 13.0833 14 13.0833C13.5858 13.0833 13.25 12.7475 13.25 12.3333C13.25 11.9493 12.8242 11.4167 12 11.4167C11.1758 11.4167 10.75 11.9493 10.75 12.3333C10.75 12.7174 11.1758 13.25 12 13.25C13.3849 13.25 14.75 14.2098 14.75 15.6667C14.75 16.857 13.8388 17.7155 12.75 17.9898V18C12.75 18.4142 12.4142 18.75 12 18.75C11.5858 18.75 11.25 18.4142 11.25 18V17.9898C10.1612 17.7155 9.25 16.857 9.25 15.6667C9.25 15.2525 9.58579 14.9167 10 14.9167C10.4142 14.9167 10.75 15.2525 10.75 15.6667C10.75 16.0507 11.1758 16.5833 12 16.5833C12.8242 16.5833 13.25 16.0507 13.25 15.6667C13.25 15.2826 12.8242 14.75 12 14.75C10.6151 14.75 9.25 13.7903 9.25 12.3333C9.25 11.143 10.1612 10.2845 11.25 10.0102V10C11.25 9.58579 11.5858 9.25 12 9.25Z" fill="#1C274C" />
        </svg>
        </div>
        </div>
        </div>
        </div> *@
    </div>


    <div class="row">
        <div class="col col-lg-4 order-0 mb-4 anim" style="--delay: .1s">
            <div class="card main-box">
                <div class="card-header pb-0 p-3">
                    <h6 class="mb-0">Time Off</h6>
                </div>
                <div class="timeOff">
                    <ul>
                        <li>
                            <div class="timeOffCard">
                                <h5>Leave Balance</h5>
                                <h2>@Model.NoOfLeaves</h2>
                                <span>Available</span>
                            </div>
                        </li>
                        <li>
                            <div class="timeOffCard">
                                <h5>Upcoming Holiday</h5>
                                @if (Model?.HolidayList != null && Model.HolidayList.Any())
                                {
                                    foreach (var item in Model.HolidayList)
                                    {
                                        <h5 class="card-title">@item.HolidayName</h5>
                                        @item.FromDate.ToString("dd/MM/yyyy")
                                    }

                                }
                                else
                                {
                                    <p>No Record Found</p>
                                }
                            </div>
                        </li>
                    </ul>
                    @*  <div class="applyLeave">
                    <a href="./leave_application.html" class="leaveapp btn btn-primary btn-download">Apply for Leave</a>
                    </div> *@
                </div>
            </div>
        </div>

        <div class="col col-lg-4 order-0 mb-4 anim" style="--delay: .1s">
            <div class="card">
                <div class="card-header pb-0 p-3">
                    <h6 class="mb-0">Attendance</h6>
                </div>
                <div class="p-3">
                    <div class="table-responsive">
                        <table class="table table-striped body-text dataTable no-footer">
                            <thead>
                                <tr>
                                    <th>Day</th>
                                    <th>present</th>
                                    <th>absent</th>
                                </tr>
                            </thead>
                            <tbody>
                                @if(Model !=null)
                                {
                                    @if(Model.AttendanceModel !=null && Model.AttendanceModel.Count()>0)
                                    {
                                        foreach(var item in Model.AttendanceModel)
                                        {
                                            <tr>
                                                <td>
                                                    @item.Day.Value.ToString("yyyy-dd-MM")
                                                </td>
                                                <td>@item.Present</td>
                                                <td>@item.Absent</td>

                                            </tr>
                                        }
                                    }
                                }
                             
                           
                            </tbody>
                        </table>
                    </div>
@*                     <a href="/employee/myinfo/TeamAttendenceList" class="viewAll">View All →</a>
 *@                </div>
            </div>
        </div>

        <div class="col col-lg-4 order-0 mb-4 anim" style="--delay: .1s">
            <div class="card">
                <div class="card-header pb-0 p-3">
                    <h6 class="mb-0">Celebrations</h6>
                </div>
                <div class="card-carousel overflow-hidden h-100 p-0">
                    <div id="carouselExampleCaptions" class="carousel slide h-100" data-bs-ride="carousel">
                        <!-- Indicators -->
                        <div class="carousel-indicators">
                            @if (Model?.EmployeeDetails != null && Model.EmployeeDetails.Any())
                            {
                                int index = 0;
                                foreach (var item in Model.EmployeeDetails)
                                {
                                    <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="@index" class="@((index == 0) ? "active" : "")" aria-label="Slide @index"></button>
                                    index++;
                                }
                            }
                            else
                            {
                                <p>No Record Found</p>
                            }
                        </div>

                        <div class="carousel-inner border-radius-lg h-100">
                            @if (Model?.EmployeeDetails != null && Model.EmployeeDetails.Any())
                            {
                                int index = 0;
                                foreach (var item in Model.EmployeeDetails)
                                {
                                    var UserPhoto = "/Uploads/ProfilePhoto/" + item.EmployeeId + "/" + @item.EmployeePhoto;
                                    var isActive = index == 0 ? "active" : "";

                                    <div class="carousel-item h-100 @isActive">
                                        <div class="carousel-caption d-none d-md-block top-10 text-center">
                                            <div class="person-img">
                                                <div class="ratio ratio-1x1 rounded-circle overflow-hidden">
                                                    @if (item.EmployeePhoto == null)
                                                    {
                                                        <img src="/assets/img/No_image.png" class="card-img-top img-cover" alt="@item.FirstName">
                                                    }
                                                    else
                                                    {
                                                        <img src="@UserPhoto" class="card-img-top img-cover" alt="@item.FirstName">
                                                    }
                                                </div>
                                            </div>
                                            <h5 class="card-title">@item.FirstName @item.LastName</h5>
                                            @if (item.DOB.HasValue)
                                            {
                                                <p class="card-text">@item.DOB.Value.ToString("MMMM d") - Happy Birthday!</p>
                                            }

                                        </div>
                                    </div>
                                    index++;
                                }
                            }
                            else
                            {
                                <p>No Record Found</p>
                            }
                        </div>

                        <!-- Controls -->
                        <button class="carousel-control-prev w-5 me-3" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Previous</span>
                        </button>
                        <button class="carousel-control-next w-5 me-3" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Next</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <div class="row">
        <div class="col col-lg-12 order-0 mb-4 anim" style="--delay: .1s">
            <div class="card">
                <div class="card-header pb-0 p-3">
                    <h6 class="mb-0">What's happening at Protalk</h6>
                </div>
                <div class="p-3">
                    <ul class="list-group body-text">
                     
                        @if (Model?.WhatsHappening != null && Model.WhatsHappening.Any(x => x.FromDate >= DateTime.Today))
                        {
                            foreach (var item in Model.WhatsHappening.Where(x => x.FromDate >= DateTime.Today))
                            {
                            <li class="list-group-item py-3">
                                <div class="d-flex justify-content-between align-items-center">                                                                    
                                    <div>
                                            <img src="/Uploads/Whatshappening/@item.IconImage" width="30" height="30">
                                            <a href="javascript:void(0)" class="font-weight-bold text-decoration-none" style="color:#05397b;">@item.Title   <b>&nbsp;&nbsp;|  @item.FromDate?.ToString("dd-MMM-yyyy") </b></a>
                                    </div>
                                     <div>
                                            <button class="btn btn-light btn-sm border border-2 view-announcement-btn"                                                  
                                                    data-title="@item.Title"
                                                    data-description="@item.Description"
                                                    data-fromdate="@item.FromDate?.ToString("dd-MMM-yyyy")"
                                                    data-todate="@item.ToDate?.ToString("dd-MMM-yyyy")"
                                                    data-image="/Uploads/Whatshappening/@item.IconImage">
                                                View Announcement
                                            </button>
                                            <a href="javascript:void(0)" class="px-2">
                                             
                                        </a>
                                    </div> 
                                    
                                </div>
                            </li>
                        }
                        }
                        else
                        {
                            <p>No Record Found</p>
                        }
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="announcementModal" tabindex="-1" aria-labelledby="announcementModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="announcementModalLabel">Announcement Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <img id="modalImage" src="" class="rounded mb-3" width="50" height="50" alt="Announcement Image">
                <h5 id="modalTitle"></h5>
                <p id="modalDescription"></p>
                <p><b>From Date:</b> <span id="modalFromDate"></span></p>
                <p><b>To Date:</b> <span id="modalToDate"></span></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondaryannouncement" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const modal = new bootstrap.Modal(document.getElementById("announcementModal"));
        document.querySelectorAll(".view-announcement-btn").forEach(button => {
            button.addEventListener("click", function () {
                const title = this.getAttribute("data-title");
                const description = this.getAttribute("data-description");
                const fromDate = this.getAttribute("data-fromdate");
                const toDate = this.getAttribute("data-todate");
                const image = this.getAttribute("data-image");
                document.getElementById("modalTitle").innerText = title;
                document.getElementById("modalDescription").innerText = description;
                document.getElementById("modalFromDate").innerText = fromDate;
                document.getElementById("modalToDate").innerText = toDate;
                document.getElementById("modalImage").src = image;

                modal.show();
            });
        });
    });





    document.getElementById('RedirectBtn').addEventListener('click', function () {
        window.location.href = '@Url.Action("GetTeamEmployeeList", "myinfo")';
    });

    document.addEventListener('DOMContentLoaded', function () {
        // Ensure the carousel is initialized correctly
        var carouselElement = document.querySelector('#carouselExampleCaptions');
        if (carouselElement) {
            var carousel = new bootstrap.Carousel(carouselElement, {
                interval: 5000, // Set auto-rotate interval
                ride: 'carousel' // Start automatically
            });
        } else {
            console.error('Carousel element not found!');
        }
    });
</script>