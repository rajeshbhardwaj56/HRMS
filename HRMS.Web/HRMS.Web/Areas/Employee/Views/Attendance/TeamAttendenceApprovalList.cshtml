@using HRMS.Models.Common
<link href="~/assets/pages/gridlist.css" rel="stylesheet" />

@{
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Attendance Approval List";
}

<div class="main-header anim" style="--delay: 0s">
    Attendance Approval List
</div>

<div class="mb-3">
    <button id="btnApproveSelected" class="btn btn-success btn-sm">
        Approve Selected
    </button>
</div>

<div class="table-responsive py-3">
    <table id="tblAttendanceApproval" class="table table-striped body-text" style="width:100%">
        <thead>
            <tr>
                <th><input type="checkbox" id="selectAll" /></th>
                <th style="display:none;">Employee ID</th>
                <th>Emp No</th>
                <th>Work Date</th>
                <th>Status</th>
                <th>Remarks</th>
            </tr>
        </thead>
    </table>
</div>

<script type="text/javascript">
    $(document).ready(function () {
        var table = $('#tblAttendanceApproval').DataTable({
            processing: true,
            serverSide: true,
            ajax: {
                url: '@Url.Action("GetAttendanceApprovalList", "Attendance", new { area = "Employee" })',
                type: 'POST',
                data: function (d) {
                    return {
                        sEcho: d.draw,
                        iDisplayStart: d.start,
                        iDisplayLength: d.length,
                        sSearch: d.search.value,
                        SortCol: d.columns[d.order[0].column].data,
                        SortDir: d.order[0].dir
                    };
                }
            },
            columns: [
                {
                    data: "id",
                    orderable: false,
                    render: function (data) {
                        return '<input type="checkbox" class="selectRow" value="' + data + '">';
                    }
                },
                { data: "employeeId", visible: false },
                { data: "employeNumber" },
                { data: "workDate" },
                { data: "attendanceStatus" },
                { data: "remarks" }
            ]
        });

        // Select/Deselect all checkboxes
        $('#selectAll').on('click', function () {
            $('.selectRow').prop('checked', this.checked);
        });

        // Approve Selected
        $('#btnApproveSelected').on('click', function () {
            var selectedIds = [];
            $('.selectRow:checked').each(function () {
                selectedIds.push($(this).val());
            });

            if (selectedIds.length === 0) {
                alert("Please select at least one record.");
                return;
            }

            $.ajax({
                url: '@Url.Action("BulkApproveAttendance", "Attendance", new { area = "Admin" })',
                type: 'POST',
                data: JSON.stringify(selectedIds),
                contentType: 'application/json',
                success: function (res) {
                    if (res.success) {
                        alert("Selected records approved successfully.");
                        table.ajax.reload();
                    } else {
                        alert(res.message || "An error occurred.");
                    }
                }
            });
        });
    });
</script>
