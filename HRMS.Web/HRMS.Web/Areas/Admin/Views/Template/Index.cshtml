@using HRMS.Models.Template;
@model TemplateModel

@{
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Template";


    var HeaderImage = "";
    var FooterImage = "";
    if (!string.IsNullOrEmpty(Model.HeaderImage))
    {
        HeaderImage = "/" + HRMS.Models.Common.Constants.TemplatePath + Model.HeaderImage;
    }
    else
    {
        HeaderImage = HRMS.Models.Common.Constants.NoImagePath;
    }

    if (!string.IsNullOrEmpty(Model.FooterImage))
    {
        FooterImage = "/" + HRMS.Models.Common.Constants.TemplatePath + Model.FooterImage;
    }
    else
    {
        FooterImage = HRMS.Models.Common.Constants.NoImagePath;
    }
}
<form method="post" id="submitForm" enctype="multipart/form-data">
    <div class="Container">

        <div class="col-md-12" style="background-color: #a7b5ce; padding: 5px;padding-left: 10px;">
            <label class="form-label">Template Details </label>
        </div>
        <div class="row">
            &nbsp;
        </div>
        <div class="row">
            <div class="row">
                <div class="col-md-4">
                    <div class="col-md-12">
                        Template Name <label class="Mandetory">*</label>
                    </div>
                    <div class="col-md-12">
                        @Html.HiddenFor(x => x.TemplateID)
                        @Html.TextBoxFor(a => a.TemplateName, new { @class = "form-control", @required = "required" })

                    </div>
                </div>
                <div class="col-md-4">
                    <div class="col-md-12">
                        Letter Head Name<label class="Mandetory">*</label>
                    </div>
                    <div class="col-md-12">
                        @Html.TextBoxFor(a => a.LetterHeadName, new { @class = "form-control", @required = "required" })
                    </div>
                </div>
            </div>
            <div class="row">
                &nbsp;
            </div>
            <div class="row">
                <div class="col-md-4">
                    <div class="col-md-12">
                        Header Image <label class="Mandetory">*</label>
                    </div>
                    <div class="col-md-12">
                        <div class="col-md-4">
                            <img src="@HeaderImage" style="width:100px; height:100px" />
                            <input type="file" name="HeaderImageFile" accept="image/*" />
                            @Html.HiddenFor(x => x.HeaderImage)
                        </div>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="col-md-12">
                        Footer Image <label class="Mandetory">*</label>
                    </div>
                    <div class="col-md-12">
                        <div class="col-md-4">
                            <img src="@FooterImage" style="width:100px; height:100px" />
                            <input type="file" name="FooterImageFile" accept="image/*" />
                            @Html.HiddenFor(x => x.FooterImage)
                        </div>

                    </div>
                </div>
            </div>
            <div class="row">
                &nbsp;
            </div>
            <div class="row">
                <div class="col-md-12">
                    <!-- Set column width to full width -->
                    <div class="col-md-12">
                        Description <label class="Mandetory">*</label>
                    </div>
                    <div class="col-md-12">

                        <!-- The toolbar will be rendered in this container. -->
                        <div id="toolbar-container"></div>

                        <!-- This container will become the editable. -->

                        <div id="editor">
                        </div>
                        <input type="hidden" id="description" name="description" />
                    </div>
                </div>
            </div>


            <div class="row">
                &nbsp;
            </div>


            <div class="row">
                <div class="col-md-12">
                    <input style="float:right" id="submitBtn" type="submit" value="Submit" class="btn btn-success" />
                    <input id="cancelButton" style="float:right; margin:0 16px;" type="button" value="Cancel" class="btn btn-success" />
                </div>

            </div>

        </div>
    </div>
</form>

<script>
    const editor = document.querySelector('#editor');
    const editorDataInput = document.querySelector('#description');
    DecoupledEditor
        .create(editor, {
            toolbar: {
                items: [
                    'heading',
                    '|',
                    'bold',
                    'italic',
                    'underline',
                    'strikethrough',
                    '|',
                    'alignment',
                    '|',
                    'link',
                    'blockquote',
                    'insertTable',
                    '|',
                    'bulletedList',
                    'numberedList',
                    '|',
                    'indent',
                    'outdent',
                    '|',
                    'fontFamily',
                    'fontSize',
                    'fontColor',
                    'fontBackgroundColor',
                    '|',
                    'removeFormat',
                    'sourceEditing',
                    '|',
                    'undo',
                    'redo'
                ]
            }
        })
        .then(editor => {
            const toolbarContainer = document.querySelector('#toolbar-container');
            toolbarContainer.appendChild(editor.ui.view.toolbar.element);

            // Set initial data to the editor
            editor.setData('@Html.Raw(Model.Description)');

            // Get the editor's data and update the input field
            const editorDataInput = document.querySelector('#description');
            editorDataInput.value = editor.getData();

            // Listen for changes in the editor's content
            editor.model.document.on('change:data', () => {
                // Get the current content of the editor
                const editorContent = editor.getData();
                // Update the input field with the editor content
                editorDataInput.value = editorContent;
                console.log("eidtor data", editorContent)
            });

        })
        .catch(error => {
            console.error(error);
        });


    document.getElementById('cancelButton').addEventListener('click', function () {
        window.location.href = '@Url.Action("TemplateListing", "Template")';
    });

    $('#FooterImageFile').attr('src', '@Model.FooterImage').show();

    $('#HeaderImageFile').attr('src', '@Model.HeaderImage').show();

    $("#submitForm").on("submit", function () {
        var footerImg = $('#FooterImageFile').attr('src');
        var headerImg = $('#HeaderImageFile').attr('src');
        console.log("footerImg", footerImg);
        console.log("headerImg", headerImg);

        if ('@Model.TemplateID' == '0' && (footerImg == null || footerImg == undefined || headerImg == null || headerImg == undefined)) {
            console.log("header and footer images required")
            return false;
        }
    })
</script>
